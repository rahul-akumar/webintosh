---
title: Viewport bounds hardening and Dock restore refinements
version: 0.1.2
date: 2025-08-17
description: Eliminated desktop scrollbars, viewport-capped resizing on all edges, integer-pixel snapping, improved focus handling, and Dock-based restore with updated tests.
---

This entry captures all changes made today.

Added
- Focus management helper [`focusTopMost()`](stores/os.ts:115) and integration to keep a valid focus when windows close or minimize.
- Desktop click now clears focus for OS-like behavior in [`onDesktopClick()`](app/components/os/Desktop.vue:16).
- Snap tuning knob [`snapThreshold`](types/os.ts:61) added to OS state for upcoming snap UX (not yet active).

Changed
- Viewport metrics now exclude scrollbars via [`getViewport()`](stores/os.ts:16) using `document.documentElement.clientWidth/Height` (instead of `window.innerWidth/Height`).
- Global CSS now prevents page-level scrolling and avoids small overflows:
  - `overflow: hidden` on `html, body, #__nuxt` and `.os-desktop-area`
  - Global `box-sizing: border-box`
  - See styles in [`app.vue`](app/app.vue:48)
- Dock restore flow is the primary macOS-like behavior:
  - Clicking a Dock icon focuses the topmost visible window or restores the topmost minimized window for that app via [`launchOrFocus()`](stores/apps.ts:83).
  - End-to-end tests updated to reflect Dock-driven restore in [`window-management.spec.ts`](tests/e2e/window-management.spec.ts:108).

Fixed
- North/West resize “slide” at min size:
  - Resizing from top/left anchors the opposite edge and recomputes `x/y` after size clamp in [`resizeTo()`](stores/os.ts:256).
- East/South infinite growth and bottom/top drift:
  - East and South edges cap size based on viewport capacity from the resize origin; no drift when touching bottom/right edges in [`resizeTo()`](stores/os.ts:256).
- Eliminated 1–2px page scrollbar:
  - Size-first clamping and integer pixel snapping in [`ensureBounds()`](stores/os.ts:123)
  - Integer snapping for live resize and maximize in [`resizeTo()`](stores/os.ts:319) and [`toggleMaximize()`](stores/os.ts:334)

Removed
- No feature removals today. The previous "Shelf" UI remains in the repo as [`Shelf.vue`](app/components/os/Shelf.vue:1) but is not used in layout.

Notes
- Window content continues to scroll internally (see `.content` in [`Window.vue`](app/components/os/Window.vue:144)); the desktop itself never scrolls.
- Snapping behavior will be implemented next using [`snapThreshold`](types/os.ts:61).